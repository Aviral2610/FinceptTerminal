import{B as l}from"./ccxt-vendor-DQA7zUGY.js";import{c as m}from"./net-shim-CnjyueI7.js";import*as y from"tls";import{a as x}from"./index-DbK550uc.js";import{A as g}from"./index-DCZNNqZp.js";import"./react-vendor-9XN-Nagm.js";import"./index-BJIVZg5l.js";import"./index-DrIlkRko.js";var H=x();function P(s){return typeof s=="string"?/^https:?$/i.test(s):!1}class $ extends g{constructor(t,e){super(e),this.proxy=typeof t=="string"?new URL(t):t,this.proxyHeaders=e?.headers??{};const o=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),a=this.proxy.port?parseInt(this.proxy.port,10):this.secureProxy?443:80;this.connectOpts={...e?v(e,"headers"):null,host:o,port:a}}get secureProxy(){return P(this.proxy.protocol)}async connect(t,e){const{proxy:o}=this,a=e.secureEndpoint?"https:":"http:",f=t.getHeader("host")||"localhost",d=`${a}//${f}`,p=new URL(t.path,d);e.port!==80&&(p.port=String(e.port)),t.path=String(p),t._header=null;const r=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders};if(o.username||o.password){const i=`${decodeURIComponent(o.username)}:${decodeURIComponent(o.password)}`;r["Proxy-Authorization"]=`Basic ${l.from(i).toString("base64")}`}r["Proxy-Connection"]||(r["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(const i of Object.keys(r)){const u=r[i];u&&t.setHeader(i,u)}let n;this.secureProxy?n=y.connect(this.connectOpts):n=m(this.connectOpts);let c,h;return t._implicitHeader(),t.outputData&&t.outputData.length>0&&(c=t.outputData[0].data,h=c.indexOf(`\r
\r
`)+4,t.outputData[0].data=t._header+c.substring(h)),await H.once(n,"connect"),n}}$.protocols=["http","https"];function v(s,...t){const e={};let o;for(o in s)t.includes(o)||(e[o]=s[o]);return e}export{$ as HttpProxyAgent};
